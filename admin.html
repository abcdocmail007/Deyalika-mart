<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DecoTech Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #004d40; --bg: #f0f4f8; }
        body { font-family: 'Hind Siliguri', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        
        .header { background: var(--primary); color: white; padding: 15px 30px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        .admin-grid { display: grid; grid-template-columns: 350px 1fr; gap: 25px; max-width: 1400px; margin: auto; }
        
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); height: fit-content; }
        h2 { font-size: 20px; color: var(--primary); margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button.upload-btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* Order Table Styling */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #f8f9fa; padding: 12px; text-align: left; border-bottom: 2px solid #eee; font-size: 14px; }
        td { padding: 15px 12px; border-bottom: 1px solid #eee; font-size: 14px; vertical-align: top; }
        
        .status-badge { background: #e8f5e9; color: #2e7d32; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 12px; }
        .payment-info { color: #1d4ed8; font-weight: 600; font-size: 12px; display: block; margin-top: 5px; }
        .delete-btn { color: #ff5252; cursor: pointer; border: none; background: none; }

        @media (max-width: 1000px) { .admin-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<script>
    if (localStorage.getItem('isAdmin') !== 'true') { window.location.href = 'login.html'; }
    function logout() { localStorage.removeItem('isAdmin'); window.location.href = 'login.html'; }
</script>

<div class="header">
    <h3>DecoTech Admin Panel</h3>
    <div>
        <a href="index.html" style="color:white; margin-right:20px; text-decoration:none;">View Website</a>
        <button onclick="logout()" style="background:#ff5252; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">Logout</button>
    </div>
</div>

<div class="admin-grid">
    <div class="card">
        <h2>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
        <input type="text" id="pName" placeholder="‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
        <input type="number" id="pPrice" placeholder="‡¶¶‡¶æ‡¶Æ (‡ß≥)">
        <input type="text" id="pImage" placeholder="‡¶á‡¶Æ‡ßá‡¶ú ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï (URL)">
        <select id="pCategory">
            <option value="Gadget">Gadget</option>
            <option value="Home Decor">Home Decor</option>
            <option value="Clothing">Clothing</option>
        </select>
        <button class="upload-btn" onclick="uploadProduct()">Add Product</button>
    </div>

    <div class="card">
        <h2>‡¶Ü‡¶∏‡¶æ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡¶ó‡ßÅ‡¶≤‡ßã (Customer Orders)</h2>
        <table>
            <thead>
                <tr>
                    <th>Customer</th>
                    <th>Phone & Address</th>
                    <th>Products</th>
                    <th>Total</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="orderTableBody">
                </tbody>
        </table>
    </div>
</div>

<script>
    const API_URL = 'https://decotech-api.onrender.com';

    // 1. Upload Product
    async function uploadProduct() {
        const product = {
            name: document.getElementById('pName').value,
            price: document.getElementById('pPrice').value,
            image: document.getElementById('pImage').value,
            category: document.getElementById('pCategory').value
        };

        const res = await fetch(`${API_URL}/api/products`, { // URL update as per typical API structure
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(product)
        });

        if (res.ok) { alert("Product Added! üéâ"); location.reload(); }
    }

    // 2. Fetch and Display Orders (Fixed Undefined Issue)
    async function loadOrders() {
        try {
            const res = await fetch(`${API_URL}/api/orders`);
            const orders = await res.json();
            const tableBody = document.getElementById('orderTableBody');

            if (orders.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">‡¶ï‡ßã‡¶® ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</td></tr>';
                return;
            }

            tableBody.innerHTML = orders.reverse().map(order => `
                <tr>
                    <td><strong>${order.customerName || 'N/A'}</strong></td>
                    <td>
                        ${order.phone || 'N/A'}<br>
                        <small style="color:#666;">${order.address || 'N/A'}</small>
                    </td>
                    <td>
                        ${order.products || 'No Items'}
                        <span class="payment-info"><i class="fas fa-wallet"></i> ${order.paymentMethod || 'COD'}</span>
                    </td>
                    <td><strong>‡ß≥ ${order.total || 0}</strong></td>
                    <td>
                        <button class="delete-btn" onclick="deleteOrder('${order._id}')">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        } catch (err) {
            console.error("Order Load Error:", err);
        }
    }

    // 3. Delete Order
    async function deleteOrder(id) {
        if(confirm("‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
            await fetch(`${API_URL}/api/orders/${id}`, { method: 'DELETE' });
            loadOrders();
        }
    }

    // Load orders on page start
    loadOrders();
</script>

</body>
</html>
